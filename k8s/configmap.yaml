apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
  namespace: intelligent-bid-system
  labels:
    app: intelligent-bid-system
    component: config
data:
  # Frontend configuration
  nextauth-url: "https://your-domain.com"
  
  # Database configuration
  postgres-db: "intelligent_bid_system"
  
  # External services
  fastgpt-url: "https://your-fastgpt-instance.com"
  
  # Application settings
  log-level: "info"
  max-concurrent-workflows: "10"
  tenant-isolation-enabled: "true"
  
  # Monitoring configuration
  prometheus-scrape-interval: "30s"
  grafana-admin-user: "admin"

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgres-init-scripts
  namespace: intelligent-bid-system
  labels:
    app: postgres
    component: database
data:
  01-init-database.sql: |
    -- Create database if not exists
    CREATE DATABASE IF NOT EXISTS intelligent_bid_system;
    
    -- Create extensions
    CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
    CREATE EXTENSION IF NOT EXISTS "pgcrypto";
    
    -- Create basic tables (this would be replaced by proper migrations)
    CREATE TABLE IF NOT EXISTS tenants (
        id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
        name VARCHAR(255) NOT NULL,
        domain VARCHAR(255) UNIQUE NOT NULL,
        created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
        updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
    );
    
    CREATE TABLE IF NOT EXISTS users (
        id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
        tenant_id UUID NOT NULL REFERENCES tenants(id),
        email VARCHAR(255) UNIQUE NOT NULL,
        name VARCHAR(255) NOT NULL,
        role VARCHAR(50) NOT NULL DEFAULT 'user',
        created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
        updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
    );
    
    CREATE TABLE IF NOT EXISTS workflows (
        id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
        tenant_id UUID NOT NULL REFERENCES tenants(id),
        user_id UUID NOT NULL REFERENCES users(id),
        name VARCHAR(255) NOT NULL,
        status VARCHAR(50) NOT NULL DEFAULT 'pending',
        config JSONB NOT NULL DEFAULT '{}',
        results JSONB DEFAULT '{}',
        created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
        updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
    );
    
    -- Create indexes
    CREATE INDEX IF NOT EXISTS idx_users_tenant_id ON users(tenant_id);
    CREATE INDEX IF NOT EXISTS idx_workflows_tenant_id ON workflows(tenant_id);
    CREATE INDEX IF NOT EXISTS idx_workflows_user_id ON workflows(user_id);
    CREATE INDEX IF NOT EXISTS idx_workflows_status ON workflows(status);
    
    -- Insert default tenant for development
    INSERT INTO tenants (name, domain) 
    VALUES ('Default Tenant', 'localhost') 
    ON CONFLICT (domain) DO NOTHING;