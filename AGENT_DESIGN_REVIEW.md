# æ™ºèƒ½ä½“è®¾è®¡å®¡æŸ¥æŠ¥å‘Š

## å®¡æŸ¥æ—¥æœŸ
2024-11-10

## å®¡æŸ¥èŒƒå›´
åŸºäºæ‹›æ ‡æ–‡æ¡£ç”Ÿæˆç³»ç»Ÿçš„æ™ºèƒ½ä½“è®¾è®¡å’Œå®ç°

---

## æ‰§è¡Œæ‘˜è¦

### æ€»ä½“è¯„ä¼°
æ™ºèƒ½ä½“è®¾è®¡**åŸºæœ¬ç¬¦åˆ**æ‹›æ ‡æ–‡æ¡£ç”Ÿæˆç³»ç»Ÿçš„é¢„æœŸï¼Œä½†å­˜åœ¨ä¸€äº›éœ€è¦æ”¹è¿›çš„åœ°æ–¹ã€‚

### å…³é”®å‘ç°
- âœ… å››ä¸ªæ ¸å¿ƒæ™ºèƒ½ä½“å·²å®ç°
- âœ… åŸºäºAutoGenæ¡†æ¶çš„æ¶æ„åˆç†
- âš ï¸ æç¤ºè¯ï¼ˆPromptï¼‰è§„èŒƒæ€§ä¸è¶³
- âš ï¸ æ™ºèƒ½ä½“é—´åä½œé€»è¾‘ç®€åŒ–
- âš ï¸ ç¼ºå°‘å®é™…çš„LLMè°ƒç”¨å®ç°
- âš ï¸ é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶ä¸å®Œå–„

---

## æ™ºèƒ½ä½“æ¶æ„åˆ†æ

### 1. æ‹›æ ‡åˆ†ææ™ºèƒ½ä½“ (TenderAnalysisAgent)

#### âœ… ä¼˜ç‚¹
1. **èŒè´£æ˜ç¡®**: ä¸“æ³¨äºæ‹›æ ‡æ–‡æ¡£åˆ†æ
2. **ç³»ç»Ÿæç¤ºè¯æ¸…æ™°**: å®šä¹‰äº†4ä¸ªæ ¸å¿ƒèŒè´£
3. **åŠŸèƒ½å®Œæ•´**: åŒ…å«æ–‡æ¡£åˆ†ç±»ã€éœ€æ±‚æå–ã€é£é™©è¯„ä¼°
4. **ç»“æ„åŒ–è¾“å‡º**: è¿”å›ç»“æ„åŒ–çš„åˆ†æç»“æœ

#### âš ï¸ é—®é¢˜

**é—®é¢˜1: æç¤ºè¯ç¼ºå°‘å…·ä½“æŒ‡å¯¼**
```python
system_message = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ‹›æ ‡æ–‡ä»¶åˆ†æä¸“å®¶ã€‚ä½ çš„ä¸»è¦èŒè´£æ˜¯ï¼š
1. åˆ†ææ‹›æ ‡æ–‡æ¡£ï¼Œæå–å…³é”®éœ€æ±‚å’Œè§„æ ¼è¦æ±‚
2. è¯†åˆ«æŠ€æœ¯è§„èŒƒã€å•†åŠ¡æ¡æ¬¾å’Œåˆè§„è¦æ±‚
3. è¯„ä¼°æŠ•æ ‡çš„å¯è¡Œæ€§å’Œé£é™©
4. ç”Ÿæˆè¯¦ç»†çš„éœ€æ±‚åˆ†ææŠ¥å‘Š

è¯·ç¡®ä¿åˆ†æå…¨é¢ã€å‡†ç¡®ï¼Œä¸ºåç»­æŠ•æ ‡å†…å®¹ç”Ÿæˆæä¾›åšå®çš„åŸºç¡€ã€‚"""
```

**æ”¹è¿›å»ºè®®**:
- æ·»åŠ è¾“å‡ºæ ¼å¼è§„èŒƒ
- æä¾›ç¤ºä¾‹å’Œæ¨¡æ¿
- æ˜ç¡®åˆ†æç»´åº¦å’Œæ ‡å‡†

**é—®é¢˜2: å®ç°è¿‡äºç®€åŒ–**
```python
def _classify_document_type(self, document: str) -> str:
    if "æ‹›æ ‡" in document and "æŠ€æœ¯" in document:
        return "æŠ€æœ¯æ‹›æ ‡"
    # è¿‡äºç®€å•çš„å…³é”®è¯åŒ¹é…
```

**æ”¹è¿›å»ºè®®**:
- ä½¿ç”¨LLMè¿›è¡Œæ™ºèƒ½åˆ†ç±»
- æ”¯æŒå¤šç§æ–‡æ¡£æ ¼å¼
- æ·»åŠ ç½®ä¿¡åº¦è¯„åˆ†

**é—®é¢˜3: ç¼ºå°‘å®é™…çš„LLMè°ƒç”¨**
- å¤§éƒ¨åˆ†é€»è¾‘æ˜¯è§„åˆ™åŸºç¡€çš„
- æ²¡æœ‰å……åˆ†åˆ©ç”¨AutoGençš„å¯¹è¯èƒ½åŠ›
- ç¼ºå°‘ä¸LLMçš„æ·±åº¦äº¤äº’

#### ğŸ“Š ç¬¦åˆåº¦è¯„åˆ†
- èŒè´£å®šä¹‰: 9/10 âœ…
- æç¤ºè¯è´¨é‡: 6/10 âš ï¸
- å®ç°å®Œæ•´æ€§: 5/10 âš ï¸
- LLMé›†æˆ: 3/10 âŒ

---

### 2. çŸ¥è¯†æ£€ç´¢æ™ºèƒ½ä½“ (KnowledgeRetrievalAgent)

#### âœ… ä¼˜ç‚¹
1. **é›†æˆRAGç³»ç»Ÿ**: ä¸FastGPTé›†æˆ
2. **å¤šç§æ£€ç´¢æ–¹æ³•**: æ”¯æŒçŸ¥è¯†åº“æœç´¢ã€è¡Œä¸šæ ‡å‡†æ£€ç´¢ç­‰
3. **é”™è¯¯å¤„ç†**: æ”¹è¿›åçš„å¼‚å¸¸å¤„ç†æœºåˆ¶
4. **é…ç½®åŒ–**: è¶…æ—¶ç­‰å‚æ•°å¯é…ç½®

#### âš ï¸ é—®é¢˜

**é—®é¢˜1: æç¤ºè¯è¿‡äºç®€å•**
```python
system_message = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„çŸ¥è¯†æ£€ç´¢ä¸“å®¶ã€‚ä½ çš„ä¸»è¦èŒè´£æ˜¯ï¼š
1. æ ¹æ®æ‹›æ ‡éœ€æ±‚ä»çŸ¥è¯†åº“ä¸­æ£€ç´¢ç›¸å…³ä¿¡æ¯
2. æä¾›è¡Œä¸šæœ€ä½³å®è·µã€æŠ€æœ¯æ ‡å‡†å’ŒæˆåŠŸæ¡ˆä¾‹
3. ååŠ©å…¶ä»–ä»£ç†è·å–ä¸“ä¸šçŸ¥è¯†å’Œå‚è€ƒèµ„æ–™
4. ç¡®ä¿æ£€ç´¢çš„ä¿¡æ¯å‡†ç¡®ã€ç›¸å…³ã€åŠæ—¶

è¯·ç¡®ä¿æ£€ç´¢çš„ä¿¡æ¯èƒ½å¤Ÿæœ‰æ•ˆæ”¯æŒæŠ•æ ‡å†…å®¹çš„ç”Ÿæˆã€‚"""
```

**æ”¹è¿›å»ºè®®**:
- æ·»åŠ æ£€ç´¢ç­–ç•¥æŒ‡å¯¼
- å®šä¹‰ç›¸å…³æ€§è¯„åˆ†æ ‡å‡†
- æä¾›çŸ¥è¯†æ•´åˆæ–¹æ³•

**é—®é¢˜2: ç¼ºå°‘çŸ¥è¯†è¿‡æ»¤å’Œæ’åº**
```python
async def search_knowledge_base(self, query: str, filters: Optional[Dict[str, Any]] = None):
    # ç›´æ¥è¿”å›RAGç»“æœï¼Œç¼ºå°‘æ™ºèƒ½è¿‡æ»¤
    response = await client.post(...)
    return results.get("data", [])
```

**æ”¹è¿›å»ºè®®**:
- ä½¿ç”¨LLMå¯¹æ£€ç´¢ç»“æœè¿›è¡Œé‡æ’åº
- æ·»åŠ ç›¸å…³æ€§è¿‡æ»¤
- æ”¯æŒå¤šè½®æ£€ç´¢ä¼˜åŒ–

**é—®é¢˜3: æ ¼å¼åŒ–è¾“å‡ºä¸å¤Ÿæ™ºèƒ½**
```python
def format_knowledge_results(self, results: Dict[str, Any]) -> str:
    # ç®€å•çš„å­—ç¬¦ä¸²æ‹¼æ¥
    formatted = "## çŸ¥è¯†æ£€ç´¢ç»“æœ\n\n"
    for i, item in enumerate(results["results"][:5], 1):
        formatted += f"{i}. **{item.get('title', 'æ— æ ‡é¢˜')}**\n"
```

**æ”¹è¿›å»ºè®®**:
- ä½¿ç”¨LLMç”Ÿæˆæ‘˜è¦
- æ ¹æ®ä¸Šä¸‹æ–‡è°ƒæ•´è¾“å‡ºæ ¼å¼
- æ·»åŠ çŸ¥è¯†å…³è”åˆ†æ

#### ğŸ“Š ç¬¦åˆåº¦è¯„åˆ†
- èŒè´£å®šä¹‰: 8/10 âœ…
- æç¤ºè¯è´¨é‡: 5/10 âš ï¸
- å®ç°å®Œæ•´æ€§: 7/10 âš ï¸
- LLMé›†æˆ: 4/10 âš ï¸

---

### 3. å†…å®¹ç”Ÿæˆæ™ºèƒ½ä½“ (ContentGenerationAgent)

#### âœ… ä¼˜ç‚¹
1. **èŒè´£æ¸…æ™°**: ä¸“æ³¨äºæŠ•æ ‡å†…å®¹ç”Ÿæˆ
2. **æ¨¡å—åŒ–è®¾è®¡**: åˆ†åˆ«ç”ŸæˆæŠ€æœ¯ã€å•†åŠ¡ã€å®æ–½æ–¹æ¡ˆ
3. **æ”¯æŒå¤šç§æ“ä½œ**: ç”Ÿæˆã€å®¡é˜…ã€ä¼˜åŒ–
4. **ç»“æ„åŒ–å†…å®¹**: æŒ‰ç« èŠ‚ç»„ç»‡å†…å®¹

#### âš ï¸ é—®é¢˜

**é—®é¢˜1: æç¤ºè¯ç¼ºå°‘é£æ ¼æŒ‡å¯¼**
```python
system_message = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ•æ ‡å†…å®¹ç”Ÿæˆä¸“å®¶ã€‚ä½ çš„ä¸»è¦èŒè´£æ˜¯ï¼š
1. åŸºäºæ‹›æ ‡åˆ†æå’Œç›¸å…³çŸ¥è¯†ç”Ÿæˆé«˜è´¨é‡çš„æŠ•æ ‡å†…å®¹
2. æŒ‰ç…§æ–‡æ¡£ç»“æ„åˆ†æ®µç”ŸæˆæŠ€æœ¯æ–¹æ¡ˆã€å•†åŠ¡æ–¹æ¡ˆç­‰å†…å®¹
3. ç¡®ä¿å†…å®¹ç¬¦åˆæ‹›æ ‡è¦æ±‚å’Œè¡Œä¸šæ ‡å‡†
4. ä¸å…¶ä»–ä»£ç†åä½œå®Œå–„å†…å®¹è´¨é‡

è¯·ç¡®ä¿ç”Ÿæˆçš„å†…å®¹ä¸“ä¸šã€å‡†ç¡®ã€æœ‰è¯´æœåŠ›ï¼Œèƒ½å¤Ÿæœ‰æ•ˆå±•ç¤ºæŠ•æ ‡ä¼˜åŠ¿ã€‚"""
```

**æ”¹è¿›å»ºè®®**:
- æ·»åŠ å†™ä½œé£æ ¼æŒ‡å—
- æä¾›å†…å®¹æ¨¡æ¿å’Œç¤ºä¾‹
- å®šä¹‰è´¨é‡æ ‡å‡†

**é—®é¢˜2: å†…å®¹ç”Ÿæˆè¿‡äºæ¨¡æ¿åŒ–**
```python
def _generate_architecture_section(self, requirements, knowledge) -> str:
    return f"""
## ç³»ç»Ÿæ¶æ„è®¾è®¡

åŸºäº{requirements.get('technical', [])}è¦æ±‚ï¼Œæˆ‘ä»¬é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼š
- è¡¨ç°å±‚ï¼šå“åº”å¼Webç•Œé¢
- ä¸šåŠ¡å±‚ï¼šå¾®æœåŠ¡æ¶æ„
- æ•°æ®å±‚ï¼šåˆ†å¸ƒå¼æ•°æ®åº“

æ¶æ„ä¼˜åŠ¿ï¼š{knowledge.get('advantages', 'é«˜å¯ç”¨ã€æ˜“æ‰©å±•')}
"""
```

**æ”¹è¿›å»ºè®®**:
- ä½¿ç”¨LLMåŠ¨æ€ç”Ÿæˆå†…å®¹
- æ ¹æ®å…·ä½“éœ€æ±‚å®šåˆ¶æ–¹æ¡ˆ
- é¿å…ç¡¬ç¼–ç çš„æ¨¡æ¿

**é—®é¢˜3: ç¼ºå°‘å†…å®¹è´¨é‡æ§åˆ¶**
- æ²¡æœ‰å†…å®¹é•¿åº¦æ§åˆ¶
- ç¼ºå°‘ä¸“ä¸šæœ¯è¯­æ£€æŸ¥
- æ²¡æœ‰ä¸€è‡´æ€§éªŒè¯

#### ğŸ“Š ç¬¦åˆåº¦è¯„åˆ†
- èŒè´£å®šä¹‰: 8/10 âœ…
- æç¤ºè¯è´¨é‡: 6/10 âš ï¸
- å®ç°å®Œæ•´æ€§: 4/10 âš ï¸
- LLMé›†æˆ: 3/10 âŒ

---

### 4. åˆè§„éªŒè¯æ™ºèƒ½ä½“ (ComplianceVerificationAgent)

#### âœ… ä¼˜ç‚¹
1. **éªŒè¯å…¨é¢**: æŠ€æœ¯ã€å•†åŠ¡ã€éœ€æ±‚è¦†ç›–åº¦
2. **é‡åŒ–è¯„åˆ†**: æä¾›å…·ä½“çš„è¯„åˆ†æœºåˆ¶
3. **ç”Ÿæˆå»ºè®®**: æä¾›æ”¹è¿›å»ºè®®
4. **æŠ¥å‘Šç”Ÿæˆ**: ç”Ÿæˆç»“æ„åŒ–æŠ¥å‘Š

#### âš ï¸ é—®é¢˜

**é—®é¢˜1: æç¤ºè¯ç¼ºå°‘éªŒè¯æ ‡å‡†**
```python
system_message = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„åˆè§„éªŒè¯ä¸“å®¶ã€‚ä½ çš„ä¸»è¦èŒè´£æ˜¯ï¼š
1. éªŒè¯æŠ•æ ‡å†…å®¹æ˜¯å¦ç¬¦åˆæ‹›æ ‡è¦æ±‚å’Œè¡Œä¸šæ ‡å‡†
2. æ£€æŸ¥æŠ€æœ¯æ–¹æ¡ˆã€å•†åŠ¡æ¡æ¬¾çš„åˆè§„æ€§
3. è¯†åˆ«æ½œåœ¨çš„é£é™©å’Œä¸ç¬¦åˆé¡¹
4. æä¾›æ”¹è¿›å»ºè®®å’Œä¼˜åŒ–æ–¹æ¡ˆ

è¯·ç¡®ä¿éªŒè¯å…¨é¢ã€å‡†ç¡®ï¼Œä¸ºæœ€ç»ˆæŠ•æ ‡è´¨é‡æä¾›ä¿éšœã€‚"""
```

**æ”¹è¿›å»ºè®®**:
- å®šä¹‰å…·ä½“çš„éªŒè¯æ ‡å‡†
- æä¾›æ£€æŸ¥æ¸…å•
- æ˜ç¡®è¯„åˆ†è§„åˆ™

**é—®é¢˜2: éªŒè¯é€»è¾‘è¿‡äºç®€å•**
```python
def _is_requirement_covered(self, requirement: str, content: Dict[str, Any]) -> bool:
    content_text = json.dumps(content, ensure_ascii=False)
    return requirement.lower() in content_text.lower()
    # ç®€å•çš„å­—ç¬¦ä¸²åŒ¹é…ï¼Œä¸å¤Ÿæ™ºèƒ½
```

**æ”¹è¿›å»ºè®®**:
- ä½¿ç”¨LLMè¿›è¡Œè¯­ä¹‰åŒ¹é…
- æ”¯æŒåŒä¹‰è¯å’Œå˜ä½“
- è¯„ä¼°è¦†ç›–è´¨é‡è€Œä¸ä»…æ˜¯å­˜åœ¨æ€§

**é—®é¢˜3: è¯„åˆ†æœºåˆ¶ä¸å¤Ÿç§‘å­¦**
```python
def _calculate_compliance_score(self, compliance_results: Dict[str, Any]) -> float:
    total_issues = technical_issues + commercial_issues
    if total_issues == 0:
        return 10.0
    elif total_issues <= 2:
        return 8.0
    # ç®€å•çš„é˜ˆå€¼åˆ¤æ–­
```

**æ”¹è¿›å»ºè®®**:
- ä½¿ç”¨åŠ æƒè¯„åˆ†
- è€ƒè™‘é—®é¢˜ä¸¥é‡ç¨‹åº¦
- æ”¯æŒè‡ªå®šä¹‰è¯„åˆ†è§„åˆ™

#### ğŸ“Š ç¬¦åˆåº¦è¯„åˆ†
- èŒè´£å®šä¹‰: 9/10 âœ…
- æç¤ºè¯è´¨é‡: 6/10 âš ï¸
- å®ç°å®Œæ•´æ€§: 6/10 âš ï¸
- LLMé›†æˆ: 4/10 âš ï¸

---

## æ™ºèƒ½ä½“åä½œåˆ†æ

### å½“å‰åä½œæ¨¡å¼

#### agent_manager.py å·¥ä½œæµ
```python
async def _execute_workflow(self, workflow_id, tender_document, requirements):
    # 1. æ‹›æ ‡åˆ†æ
    analysis_result = await self._run_tender_analysis(...)
    
    # 2. çŸ¥è¯†æ£€ç´¢
    knowledge_result = await self._run_knowledge_retrieval(...)
    
    # 3. å†…å®¹ç”Ÿæˆ
    content_result = await self._run_content_generation(...)
    
    # 4. åˆè§„éªŒè¯
    compliance_result = await self._run_compliance_verification(...)
```

### âœ… ä¼˜ç‚¹
1. **é¡ºåºæ¸…æ™°**: é€»è¾‘æµç¨‹åˆç†
2. **æ•°æ®ä¼ é€’**: ä¸Šä¸‹æ–‡ä¿¡æ¯ä¼ é€’
3. **çŠ¶æ€ç®¡ç†**: å·¥ä½œæµçŠ¶æ€è·Ÿè¸ª

### âš ï¸ é—®é¢˜

**é—®é¢˜1: ç¼ºå°‘æ™ºèƒ½ä½“é—´å¯¹è¯**
- å½“å‰æ˜¯å•å‘æ•°æ®ä¼ é€’
- æ²¡æœ‰æ™ºèƒ½ä½“é—´çš„åå•†å’Œè®¨è®º
- ç¼ºå°‘åé¦ˆå¾ªç¯

**æ”¹è¿›å»ºè®®**:
```python
# åº”è¯¥æ”¯æŒæ™ºèƒ½ä½“é—´å¯¹è¯
async def _collaborative_generation(self):
    # å†…å®¹ç”Ÿæˆæ™ºèƒ½ä½“ç”Ÿæˆåˆç¨¿
    draft = await content_agent.generate(...)
    
    # åˆè§„æ™ºèƒ½ä½“å®¡æŸ¥å¹¶æä¾›åé¦ˆ
    feedback = await compliance_agent.review(draft)
    
    # å†…å®¹ç”Ÿæˆæ™ºèƒ½ä½“æ ¹æ®åé¦ˆä¼˜åŒ–
    refined = await content_agent.refine(draft, feedback)
    
    # çŸ¥è¯†æ£€ç´¢æ™ºèƒ½ä½“è¡¥å……ä¿¡æ¯
    enhanced = await knowledge_agent.enhance(refined)
```

**é—®é¢˜2: ç¼ºå°‘äººå·¥å¹²é¢„ç‚¹**
- å·¥ä½œæµå®Œå…¨è‡ªåŠ¨åŒ–
- æ²¡æœ‰äººå·¥å®¡æ ¸å’Œè°ƒæ•´çš„æœºä¼š
- ç¼ºå°‘äº¤äº’å¼ä¼˜åŒ–

**æ”¹è¿›å»ºè®®**:
- åœ¨å…³é”®èŠ‚ç‚¹æ·»åŠ äººå·¥å®¡æ ¸
- æ”¯æŒç”¨æˆ·åé¦ˆå’Œè°ƒæ•´
- å®ç°åŠè‡ªåŠ¨åŒ–å·¥ä½œæµ

**é—®é¢˜3: é”™è¯¯æ¢å¤æœºåˆ¶ä¸è¶³**
```python
try:
    result = await self._run_tender_analysis(...)
except ValueError as e:
    # ç®€å•çš„é”™è¯¯å¤„ç†ï¼Œæ²¡æœ‰æ¢å¤æœºåˆ¶
    self._update_workflow_status(..., error=str(e))
```

**æ”¹è¿›å»ºè®®**:
- æ·»åŠ é‡è¯•æœºåˆ¶
- æ”¯æŒéƒ¨åˆ†å¤±è´¥æ¢å¤
- å®ç°æ£€æŸ¥ç‚¹å’Œå›æ»š

---

## æç¤ºè¯ï¼ˆPromptï¼‰è§„èŒƒæ€§å®¡æŸ¥

### å½“å‰æç¤ºè¯ç»“æ„

æ‰€æœ‰æ™ºèƒ½ä½“çš„æç¤ºè¯éƒ½éµå¾ªç±»ä¼¼çš„æ¨¡å¼ï¼š
```python
system_message = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„XXXä¸“å®¶ã€‚ä½ çš„ä¸»è¦èŒè´£æ˜¯ï¼š
1. èŒè´£1
2. èŒè´£2
3. èŒè´£3
4. èŒè´£4

è¯·ç¡®ä¿XXXã€‚"""
```

### âš ï¸ é—®é¢˜åˆ†æ

#### 1. ç¼ºå°‘è§’è‰²èƒŒæ™¯
- æ²¡æœ‰å®šä¹‰ä¸“ä¸šèƒŒæ™¯å’Œç»éªŒ
- ç¼ºå°‘è¡Œä¸šçŸ¥è¯†èŒƒå›´
- æ²¡æœ‰æ˜ç¡®èƒ½åŠ›è¾¹ç•Œ

#### 2. ç¼ºå°‘è¾“å‡ºæ ¼å¼è§„èŒƒ
- æ²¡æœ‰æŒ‡å®šè¾“å‡ºç»“æ„
- ç¼ºå°‘æ ¼å¼ç¤ºä¾‹
- æ²¡æœ‰é•¿åº¦å’Œé£æ ¼è¦æ±‚

#### 3. ç¼ºå°‘çº¦æŸæ¡ä»¶
- æ²¡æœ‰æ˜ç¡®ç¦æ­¢äº‹é¡¹
- ç¼ºå°‘è´¨é‡æ ‡å‡†
- æ²¡æœ‰é”™è¯¯å¤„ç†æŒ‡å¯¼

#### 4. ç¼ºå°‘ä¸Šä¸‹æ–‡ä¿¡æ¯
- æ²¡æœ‰æä¾›è¡Œä¸šèƒŒæ™¯
- ç¼ºå°‘é¡¹ç›®ä¸Šä¸‹æ–‡
- æ²¡æœ‰ç”¨æˆ·åå¥½ä¿¡æ¯

### âœ… æ”¹è¿›å»ºè®®

#### æ ‡å‡†æç¤ºè¯æ¨¡æ¿
```python
system_message = """# è§’è‰²å®šä¹‰
ä½ æ˜¯ä¸€ä½æ‹¥æœ‰10å¹´ä»¥ä¸Šç»éªŒçš„{ä¸“ä¸šé¢†åŸŸ}ä¸“å®¶ï¼Œä¸“æ³¨äº{å…·ä½“é¢†åŸŸ}ã€‚

# ä¸“ä¸šèƒŒæ™¯
- ç†Ÿæ‚‰{è¡Œä¸šæ ‡å‡†}å’Œ{æœ€ä½³å®è·µ}
- ç²¾é€š{æŠ€æœ¯æ ˆ}å’Œ{æ–¹æ³•è®º}
- å…·æœ‰{é¡¹ç›®ç±»å‹}çš„ä¸°å¯Œç»éªŒ

# æ ¸å¿ƒèŒè´£
1. {å…·ä½“èŒè´£1}ï¼š{è¯¦ç»†è¯´æ˜}
2. {å…·ä½“èŒè´£2}ï¼š{è¯¦ç»†è¯´æ˜}
3. {å…·ä½“èŒè´£3}ï¼š{è¯¦ç»†è¯´æ˜}

# è¾“å‡ºè¦æ±‚
## æ ¼å¼
- ä½¿ç”¨Markdownæ ¼å¼
- åŒ…å«{å¿…éœ€ç« èŠ‚}
- é•¿åº¦æ§åˆ¶åœ¨{èŒƒå›´}

## è´¨é‡æ ‡å‡†
- å‡†ç¡®æ€§ï¼š{æ ‡å‡†}
- å®Œæ•´æ€§ï¼š{æ ‡å‡†}
- ä¸“ä¸šæ€§ï¼š{æ ‡å‡†}

## çº¦æŸæ¡ä»¶
- ä¸è¦{ç¦æ­¢äº‹é¡¹1}
- é¿å…{ç¦æ­¢äº‹é¡¹2}
- ç¡®ä¿{å¿…é¡»äº‹é¡¹}

# å·¥ä½œæµç¨‹
1. åˆ†æè¾“å…¥ï¼š{è¯´æ˜}
2. å¤„ç†æ•°æ®ï¼š{è¯´æ˜}
3. ç”Ÿæˆè¾“å‡ºï¼š{è¯´æ˜}
4. è´¨é‡æ£€æŸ¥ï¼š{è¯´æ˜}

# ç¤ºä¾‹
{æä¾›1-2ä¸ªç¤ºä¾‹}

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸Šè¦æ±‚æ‰§è¡Œä»»åŠ¡ã€‚"""
```

---

## LLMé›†æˆåˆ†æ

### å½“å‰å®ç°

#### base_agent.py
```python
async def _chat_with_agent(self, message: str) -> str:
    result: TaskResult = await self.autogen_agent.run(task=message)
    if result.messages:
        last_message = result.messages[-1]
        if hasattr(last_message, 'content'):
            content = getattr(last_message, 'content', '')
            return content or ""
    return ""
```

### âš ï¸ é—®é¢˜

**é—®é¢˜1: ç¼ºå°‘å®é™…çš„LLMè°ƒç”¨**
- å¤§éƒ¨åˆ†æ™ºèƒ½ä½“ä½¿ç”¨ç¡¬ç¼–ç é€»è¾‘
- æ²¡æœ‰å……åˆ†åˆ©ç”¨LLMçš„ç”Ÿæˆèƒ½åŠ›
- AutoGené›†æˆä¸å®Œæ•´

**é—®é¢˜2: ç¼ºå°‘å¯¹è¯å†å²ç®¡ç†**
- æ²¡æœ‰ç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡
- ç¼ºå°‘å¤šè½®å¯¹è¯æ”¯æŒ
- æ²¡æœ‰è®°å¿†æœºåˆ¶

**é—®é¢˜3: ç¼ºå°‘å‚æ•°æ§åˆ¶**
- æ¸©åº¦ã€top_pç­‰å‚æ•°å›ºå®š
- æ²¡æœ‰æ ¹æ®ä»»åŠ¡è°ƒæ•´å‚æ•°
- ç¼ºå°‘è¾“å‡ºé•¿åº¦æ§åˆ¶

### âœ… æ”¹è¿›å»ºè®®

```python
class BaseAgent(ABC):
    async def _chat_with_agent(
        self, 
        message: str,
        context: Optional[List[Dict]] = None,
        temperature: float = 0.7,
        max_tokens: int = 2000
    ) -> str:
        # æ„å»ºå®Œæ•´çš„å¯¹è¯å†å²
        messages = []
        if context:
            messages.extend(context)
        messages.append({"role": "user", "content": message})
        
        # è°ƒç”¨LLM
        result = await self.autogen_agent.run(
            task=message,
            temperature=temperature,
            max_tokens=max_tokens
        )
        
        # è§£æå’ŒéªŒè¯å“åº”
        response = self._parse_response(result)
        
        # æ›´æ–°å¯¹è¯å†å²
        self._update_conversation_history(message, response)
        
        return response
```

---

## æ€»ä½“è¯„ä¼°

### ç¬¦åˆåº¦çŸ©é˜µ

| æ™ºèƒ½ä½“ | èŒè´£å®šä¹‰ | æç¤ºè¯è´¨é‡ | å®ç°å®Œæ•´æ€§ | LLMé›†æˆ | æ€»åˆ† |
|--------|----------|------------|------------|---------|------|
| æ‹›æ ‡åˆ†æ | 9/10 | 6/10 | 5/10 | 3/10 | 5.75/10 |
| çŸ¥è¯†æ£€ç´¢ | 8/10 | 5/10 | 7/10 | 4/10 | 6.0/10 |
| å†…å®¹ç”Ÿæˆ | 8/10 | 6/10 | 4/10 | 3/10 | 5.25/10 |
| åˆè§„éªŒè¯ | 9/10 | 6/10 | 6/10 | 4/10 | 6.25/10 |
| **å¹³å‡** | **8.5/10** | **5.75/10** | **5.5/10** | **3.5/10** | **5.8/10** |

### å…³é”®å‘ç°

#### âœ… åšå¾—å¥½çš„æ–¹é¢
1. **æ¶æ„è®¾è®¡**: åŸºäºAutoGençš„æ¶æ„åˆç†
2. **èŒè´£åˆ’åˆ†**: å››ä¸ªæ™ºèƒ½ä½“èŒè´£æ¸…æ™°
3. **æ¨¡å—åŒ–**: ä»£ç ç»“æ„è‰¯å¥½
4. **ç›‘æ§é›†æˆ**: æ—¥å¿—å’ŒæŒ‡æ ‡æ”¶é›†å®Œå–„

#### âš ï¸ éœ€è¦æ”¹è¿›çš„æ–¹é¢
1. **æç¤ºè¯è´¨é‡**: ç¼ºå°‘è¯¦ç»†è§„èŒƒå’Œç¤ºä¾‹
2. **LLMé›†æˆ**: å¤§é‡ç¡¬ç¼–ç é€»è¾‘ï¼Œæœªå……åˆ†åˆ©ç”¨LLM
3. **æ™ºèƒ½ä½“åä½œ**: ç¼ºå°‘å¯¹è¯å’Œåé¦ˆæœºåˆ¶
4. **é”™è¯¯å¤„ç†**: é‡è¯•å’Œæ¢å¤æœºåˆ¶ä¸è¶³

#### âŒ ä¸¥é‡é—®é¢˜
1. **å†…å®¹ç”Ÿæˆè¿‡äºæ¨¡æ¿åŒ–**: ä¸å¤Ÿæ™ºèƒ½å’Œçµæ´»
2. **éªŒè¯é€»è¾‘ç®€å•**: åŸºäºå…³é”®è¯åŒ¹é…è€Œéè¯­ä¹‰ç†è§£
3. **ç¼ºå°‘äººå·¥å¹²é¢„**: å®Œå…¨è‡ªåŠ¨åŒ–å¯èƒ½å¯¼è‡´è´¨é‡é—®é¢˜

---

## æ”¹è¿›å»ºè®®

### é«˜ä¼˜å…ˆçº§ï¼ˆæœ¬å‘¨ï¼‰

1. **æ”¹è¿›æç¤ºè¯**
   - ä½¿ç”¨æ ‡å‡†æ¨¡æ¿
   - æ·»åŠ è¯¦ç»†è§„èŒƒ
   - æä¾›ç¤ºä¾‹å’Œçº¦æŸ

2. **å¢å¼ºLLMé›†æˆ**
   - æ›¿æ¢ç¡¬ç¼–ç é€»è¾‘ä¸ºLLMè°ƒç”¨
   - å®ç°åŠ¨æ€å†…å®¹ç”Ÿæˆ
   - æ·»åŠ å‚æ•°æ§åˆ¶

3. **æ·»åŠ äººå·¥å¹²é¢„ç‚¹**
   - åœ¨å…³é”®èŠ‚ç‚¹æ·»åŠ å®¡æ ¸
   - æ”¯æŒç”¨æˆ·åé¦ˆ
   - å®ç°äº¤äº’å¼ä¼˜åŒ–

### ä¸­ä¼˜å…ˆçº§ï¼ˆæœ¬æœˆï¼‰

4. **å®ç°æ™ºèƒ½ä½“åä½œ**
   - æ·»åŠ æ™ºèƒ½ä½“é—´å¯¹è¯
   - å®ç°åé¦ˆå¾ªç¯
   - æ”¯æŒåå•†å’Œè®¨è®º

5. **æ”¹è¿›éªŒè¯é€»è¾‘**
   - ä½¿ç”¨è¯­ä¹‰åŒ¹é…
   - å®ç°æ™ºèƒ½è¯„åˆ†
   - æ·»åŠ è´¨é‡æ§åˆ¶

6. **å¢å¼ºé”™è¯¯å¤„ç†**
   - æ·»åŠ é‡è¯•æœºåˆ¶
   - å®ç°æ£€æŸ¥ç‚¹
   - æ”¯æŒéƒ¨åˆ†æ¢å¤

### ä½ä¼˜å…ˆçº§ï¼ˆä¸‹å­£åº¦ï¼‰

7. **ä¼˜åŒ–æ€§èƒ½**
   - å¹¶è¡Œå¤„ç†
   - ç¼“å­˜æœºåˆ¶
   - æ‰¹é‡æ“ä½œ

8. **æ‰©å±•åŠŸèƒ½**
   - æ”¯æŒæ›´å¤šæ–‡æ¡£ç±»å‹
   - æ·»åŠ æ›´å¤šæ™ºèƒ½ä½“
   - å®ç°è‡ªå®šä¹‰å·¥ä½œæµ

---

## ç»“è®º

æ™ºèƒ½ä½“è®¾è®¡åœ¨æ¶æ„å’ŒèŒè´£åˆ’åˆ†ä¸Š**åŸºæœ¬ç¬¦åˆé¢„æœŸ**ï¼Œä½†åœ¨æç¤ºè¯è´¨é‡ã€LLMé›†æˆå’Œæ™ºèƒ½ä½“åä½œæ–¹é¢**éœ€è¦æ˜¾è‘—æ”¹è¿›**ã€‚

**æ€»ä½“ç¬¦åˆåº¦**: 5.8/10 âš ï¸

**å»ºè®®**: ä¼˜å…ˆæ”¹è¿›æç¤ºè¯å’ŒLLMé›†æˆï¼Œç„¶åé€æ­¥å¢å¼ºæ™ºèƒ½ä½“åä½œå’Œé”™è¯¯å¤„ç†æœºåˆ¶ã€‚

---

## é™„å½•ï¼šæ”¹è¿›ç¤ºä¾‹

### ç¤ºä¾‹1: æ”¹è¿›çš„æ‹›æ ‡åˆ†ææç¤ºè¯

```python
system_message = """# è§’è‰²å®šä¹‰
ä½ æ˜¯ä¸€ä½æ‹¥æœ‰15å¹´ç»éªŒçš„æ‹›æ ‡æ–‡ä»¶åˆ†æä¸“å®¶ï¼Œä¸“æ³¨äºæ”¿åºœé‡‡è´­å’Œä¼ä¸šæ‹›æ ‡é¡¹ç›®ã€‚

# ä¸“ä¸šèƒŒæ™¯
- ç†Ÿæ‚‰ã€Šæ”¿åºœé‡‡è´­æ³•ã€‹ã€ã€Šæ‹›æ ‡æŠ•æ ‡æ³•ã€‹ç­‰æ³•å¾‹æ³•è§„
- ç²¾é€šæŠ€æœ¯è§„èŒƒã€å•†åŠ¡æ¡æ¬¾å’Œåˆè§„è¦æ±‚åˆ†æ
- å…·æœ‰500+æ‹›æ ‡é¡¹ç›®åˆ†æç»éªŒï¼Œæ¶µç›–ITã€å·¥ç¨‹ã€æœåŠ¡ç­‰å¤šä¸ªé¢†åŸŸ

# æ ¸å¿ƒèŒè´£
1. æ–‡æ¡£åˆ†æï¼šè¯†åˆ«æ‹›æ ‡ç±»å‹ã€å…³é”®ç« èŠ‚ã€æˆªæ­¢æ—¥æœŸå’Œé¢„ç®—ä¿¡æ¯
2. éœ€æ±‚æå–ï¼šæå–æŠ€æœ¯ã€å•†åŠ¡ã€åˆè§„ä¸‰ç±»éœ€æ±‚ï¼Œç¡®ä¿æ— é—æ¼
3. é£é™©è¯„ä¼°ï¼šè¯†åˆ«æŠ€æœ¯ã€å•†åŠ¡ã€æ—¶é—´ä¸‰ç±»é£é™©ï¼Œè¯„ä¼°ä¸¥é‡ç¨‹åº¦
4. æŠ¥å‘Šç”Ÿæˆï¼šç”Ÿæˆç»“æ„åŒ–åˆ†ææŠ¥å‘Šï¼Œä¸ºæŠ•æ ‡å†³ç­–æä¾›ä¾æ®

# è¾“å‡ºè¦æ±‚
## æ ¼å¼
ä½¿ç”¨JSONæ ¼å¼è¾“å‡ºï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
{
  "document_type": "æ‹›æ ‡ç±»å‹",
  "key_sections": ["ç« èŠ‚1", "ç« èŠ‚2"],
  "deadline": "YYYY-MM-DD",
  "budget_range": "é¢„ç®—èŒƒå›´",
  "requirements": {
    "technical": ["éœ€æ±‚1", "éœ€æ±‚2"],
    "commercial": ["éœ€æ±‚1", "éœ€æ±‚2"],
    "compliance": ["éœ€æ±‚1", "éœ€æ±‚2"]
  },
  "risks": {
    "technical": [{"risk": "é£é™©æè¿°", "severity": "high/medium/low"}],
    "commercial": [...],
    "timeline": [...]
  },
  "feasibility_score": 0-100,
  "recommendations": ["å»ºè®®1", "å»ºè®®2"]
}

## è´¨é‡æ ‡å‡†
- å‡†ç¡®æ€§ï¼šéœ€æ±‚æå–å‡†ç¡®ç‡>95%
- å®Œæ•´æ€§ï¼šè¦†ç›–æ‰€æœ‰å…³é”®ç« èŠ‚
- ä¸“ä¸šæ€§ï¼šä½¿ç”¨è¡Œä¸šæœ¯è¯­ï¼Œé¿å…å£è¯­åŒ–

## çº¦æŸæ¡ä»¶
- ä¸è¦é—æ¼ä»»ä½•æ˜ç¡®çš„éœ€æ±‚
- é¿å…ä¸»è§‚è‡†æ–­ï¼ŒåŸºäºæ–‡æ¡£å†…å®¹åˆ†æ
- ç¡®ä¿é£é™©è¯„ä¼°å®¢è§‚ã€æœ‰ä¾æ®

# å·¥ä½œæµç¨‹
1. æ–‡æ¡£æ‰«æï¼šè¯†åˆ«æ–‡æ¡£ç»“æ„å’Œå…³é”®ä¿¡æ¯
2. éœ€æ±‚æå–ï¼šé€ç« èŠ‚æå–éœ€æ±‚ï¼Œåˆ†ç±»æ•´ç†
3. é£é™©è¯†åˆ«ï¼šåŸºäºéœ€æ±‚å’Œç»éªŒè¯†åˆ«é£é™©
4. å¯è¡Œæ€§è¯„ä¼°ï¼šç»¼åˆè¯„ä¼°æŠ•æ ‡å¯è¡Œæ€§
5. ç”ŸæˆæŠ¥å‘Šï¼šè¾“å‡ºç»“æ„åŒ–åˆ†æç»“æœ

# ç¤ºä¾‹
è¾“å…¥ï¼šæŸITç³»ç»Ÿæ‹›æ ‡æ–‡ä»¶
è¾“å‡ºï¼š
{
  "document_type": "æŠ€æœ¯æ‹›æ ‡-ITç³»ç»Ÿ",
  "feasibility_score": 85,
  "recommendations": ["å»ºè®®ç»„å»ºè·¨éƒ¨é—¨å›¢é˜Ÿ", "å»ºè®®æå‰å‡†å¤‡èµ„è´¨ææ–™"]
}

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸Šè¦æ±‚åˆ†ææ‹›æ ‡æ–‡æ¡£ã€‚"""
```

### ç¤ºä¾‹2: æ”¹è¿›çš„å†…å®¹ç”Ÿæˆé€»è¾‘

```python
async def generate_technical_proposal(
    self,
    requirements: Dict[str, Any],
    knowledge: Dict[str, Any]
) -> Dict[str, Any]:
    # æ„å»ºè¯¦ç»†çš„æç¤ºè¯
    prompt = f"""
åŸºäºä»¥ä¸‹æ‹›æ ‡éœ€æ±‚å’ŒçŸ¥è¯†åº“ä¿¡æ¯ï¼Œç”Ÿæˆä¸“ä¸šçš„æŠ€æœ¯æ–¹æ¡ˆï¼š

## æ‹›æ ‡éœ€æ±‚
{json.dumps(requirements, ensure_ascii=False, indent=2)}

## ç›¸å…³çŸ¥è¯†
{json.dumps(knowledge, ensure_ascii=False, indent=2)}

## ç”Ÿæˆè¦æ±‚
1. ç³»ç»Ÿæ¶æ„ï¼šè¯¦ç»†è¯´æ˜æŠ€æœ¯æ¶æ„ï¼ŒåŒ…æ‹¬å±‚æ¬¡åˆ’åˆ†ã€æŠ€æœ¯é€‰å‹ã€æ‰©å±•æ€§è®¾è®¡
2. åŠŸèƒ½å®ç°ï¼šé€é¡¹è¯´æ˜å¦‚ä½•å®ç°æ‹›æ ‡è¦æ±‚çš„åŠŸèƒ½
3. æ€§èƒ½ä¿è¯ï¼šæä¾›å…·ä½“çš„æ€§èƒ½æŒ‡æ ‡å’Œä¼˜åŒ–ç­–ç•¥
4. æŠ€æœ¯ä¼˜åŠ¿ï¼šçªå‡ºæˆ‘ä»¬çš„æŠ€æœ¯ç‰¹è‰²å’Œç«äº‰ä¼˜åŠ¿

è¯·ç”Ÿæˆ2000-3000å­—çš„ä¸“ä¸šæŠ€æœ¯æ–¹æ¡ˆã€‚
"""
    
    # è°ƒç”¨LLMç”Ÿæˆå†…å®¹
    response = await self._chat_with_agent(
        prompt,
        temperature=0.7,
        max_tokens=4000
    )
    
    # è§£æå’ŒéªŒè¯å“åº”
    technical_content = self._parse_technical_content(response)
    
    # è´¨é‡æ£€æŸ¥
    quality_score = await self._assess_content_quality(technical_content)
    
    if quality_score < 0.7:
        # å¦‚æœè´¨é‡ä¸å¤Ÿï¼Œé‡æ–°ç”Ÿæˆ
        response = await self._regenerate_with_feedback(
            prompt,
            technical_content,
            "è¯·å¢åŠ æŠ€æœ¯ç»†èŠ‚å’Œä¸“ä¸šæ€§"
        )
        technical_content = self._parse_technical_content(response)
    
    return {
        "success": True,
        "content": technical_content,
        "quality_score": quality_score
    }
```

---

**å®¡æŸ¥å®Œæˆæ—¥æœŸ**: 2024-11-10  
**å®¡æŸ¥äºº**: AI Code Reviewer  
**ç‰ˆæœ¬**: 1.0
